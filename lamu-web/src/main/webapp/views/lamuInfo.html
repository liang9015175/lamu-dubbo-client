<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="/css/bootstrap.css">
    <script type="text/javascript" src="/js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
</head>
<style type="text/css">
    li {
        margin-right: 18px;
    }

    td {
        margin: 2px;
    }

    td input[type='file'] {
        display: inline-block;
        margin-left: 100px;
    }
</style>
<body style="min-width: 1300px">

<div class=" col-sm-12 page-header" style="text-align: center">

    <ul class="nav nav-pills" style="margin-left: auto; margin-right: auto">
        <li style="margin-left: 35%;"><a href="index.html">首页</a></li>
        <li class="dropdown" class="active">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">轮播图<span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/views/galleryUpload.html">轮播图上传</a></li>
                <li class="divider"></li>
                <li><a href="/views/galleryList.html">轮播图列表</a></li>
            </ul>
        </li>
        <li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">辣木<span
                class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/views/productionUpload.html">辣木上传</a></li>
                <li class="divider"></li>
                <li><a href="/views/lamuList.html">辣木列表</a></li>
            </ul>
        </li>
        <li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown">订单<span
                class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="/views/galleryUpload.html">订单列表</a></li>
            </ul>
        </li>
        <li><a>用户</a></li>
        <li><a>评论</a></li>
        <li><a>公告</a></li>
    </ul>

</div>
<div class="container">
    <div class="col-sm-12">
        <div class="center-block" style="width: 70%">
            <form role="form" enctype="multipart/form-data" id="form">
                <table class=" table-responsive" style="width: 100%">
                    <thead class="active">
                    <th colspan="2" style="text-align: center"><h3 class="text-success">辣木上传</h3></th>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">商品名称：</td>
                        <td><input type="text" class="form-control" placeholder="请输入商品的名称." name="name"></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">商品描述：</td>
                        <td><input type="text" class="form-control" placeholder="请输入商品的描述信息." name="despriction"></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">商品价格：</td>
                        <td><input type="text" class="form-control" placeholder="请输入商品的价格. 如：75" name="price"></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">商品折扣：</td>
                        <td><input type="text" class="form-control" placeholder="一折请输入1" name="discount"></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">商品单位：</td>
                        <td><input type="text" class="form-control" placeholder="如：kg或者瓶" name="unit"></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">关键词：</td>
                        <td><input type="text" class="form-control" placeholder="关键词请用逗号隔开，如：辣木，优惠" name="keyword"></td>
                    </tr>

                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">推荐区图片：</td>
                        <td><input type="file" name="file" id="recommandPic"><a class="btn" onclick="updatePic(this)"
                                                                                data-sort="0">更新</a></td>
                    </tr>

                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">简介区图片：</td>
                        <td><input type="file" name="file" id="shortPic1"><a class="btn" onclick="updatePic(this)"
                                                                             data-sort="1">更新</a></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">简介区图片：</td>
                        <td><input type="file" name="file" id="shortPic2"><a class="btn" onclick="updatePic(this)"
                                                                             data-sort="2">更新</a></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">简介区图片：：</td>
                        <td><input type="file" name="file" id="shortPic3"><a class="btn" onclick="updatePic(this)"
                                                                             data-sort="3">更新</a></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">简介区图片：</td>
                        <td><input type="file" name="file" id="shortPic4"><a class="btn" onclick="updatePic(this)"
                                                                             data-sort="4">更新</a></td>
                    </tr>

                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">介绍区图片：</td>
                        <td><input type="file" name="file" id="infoPic1"><a class="btn" onclick="updatePic(this)"
                                                                            data-sort="5">更新</a></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">介绍区图片：</td>
                        <td><input type="file" name="file" id="infoPic2"><a class="btn" onclick="updatePic(this)"
                                                                            data-sort="6">更新</a></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">介绍区图片：</td>
                        <td><input type="file" name="file" id="infoPic3" width="80%"><a class="btn"
                                                                                        onclick="updatePic(this)"
                                                                                        data-sort="7">更新</a></td>
                    </tr>
                    <tr>
                        <td class="active form-control" style="background-color:#f5f5f5">介绍区图片：</td>
                        <td><input type="file" name="file" id="infoPic4"><a class="btn" onclick="updatePic(this)"
                                                                            data-sort="8">更新</a></td>
                    </tr>
                    </tbody>
                    <tfoot style="margin-top: 10px">
                    <tr>
                        <td colspan="2" style="text-align: center">
                            <input type="button" class="btn" value="提交" onclick="update(this)"
                                   style="margin-right: -575px;">
                            <input type="reset" class="btn" value="取消" style="float: right;">
                        </td>
                    </tr>
                    </tfoot>
                </table>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
    //url截取参数
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    //获取辣木基本信息
    $(document).ready(function () {
        var uuid = getQueryString("id");
        $.ajax({
            url: "/lamu/view",
            type: "GET",
            data: {id: uuid},
            dataType: "JSON",
            success: function (data) {
                var o_json = JSON.parse(data);
                var oo_json = o_json.replyInfo;
                oo_json = JSON.parse(oo_json);
                console.log(oo_json);
                $("input[name='name']").val(oo_json.name);
                $("input[name='despriction']").val(oo_json.despriction);
                $("input[name='price']").val(oo_json.price);
                $("input[name='discount']").val(oo_json.discount);
                $("input[name='unit']").val(oo_json.unit);
                $("input[name='keyword']").val(oo_json.keyword);
                $(".btn").each(function () {
                    console.log($(this));
                    console.log(oo_json.uuid);
                    $(this).attr("data-id", oo_json.uuid);
                })
            }
        })
    });

    //更新照片
    function updatePic(e) {
        var uuid = $(e).attr("data-id");
        var sort = $(e).attr("data-sort");
        var file = $(e).prev().get(0).files[0];
        var form = new FormData();
        form.append("uuid", uuid);
        form.append("sort", sort);
        form.append("file", file);
        $.ajax({
            url: "/lamu/updatePic",
            data: form,
            dataType: "JSON",
            type: "POST",
            processData: false,
            contentType: false,
            success: function (data) {
                var json = JSON.parse(data);
                alert(json.replyInfo);
            }
        })
    }
    ;
    function update(e) {
        var name = $("input[name='name']").val();
        var description = $("input[name='despriction']").val();
        var price = $("input[name='price']").val();
        var discount = $("input[name='discount']").val();
        var unit = $("input[name='unit']").val();
        var keyword = $("input[name='keyword']").val();
        var id = $(e).attr("data-id");
        var form = new FormData();
        form.append("name", name);
        form.append("despriction", description);
        form.append("price", price);
        form.append("discount", discount);
        form.append("unit", unit);
        form.append("keyword", keyword);
        form.append("id", id);
        $.ajax({
            url: "/lamu/update",
            data: form,
            dataType: "JSON",
            type: "post",
            processData: false,
            contentType: false,
            success: function (data) {
                var json = JSON.parse(data);
                if (json.replyCode == 1) {
                    alert(json.replyInfo);
                    location.href = "/views/lamuList.html";
                } else {
                    alert(json.replyInfo);
                }
            }
        })

    }
</script>

</body>
</html>